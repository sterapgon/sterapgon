Sub ExtractUniqueRows() 'นำข้อมูลออกจากชีมเพื่อมาสร้างใหม่ 1 รายการโดยค้นหาจากค่า SUPOFFCOD
    Dim wsSource As Worksheet
    Dim wsTarget As Worksheet
    Dim lastRow As Long, i As Long
    Dim uniqueValues As Collection
    Dim cell As Range
    Dim rng As Range

    ' Set source and target sheets
    Set wsSource = ThisWorkbook.Sheets("NID_00005222")
    On Error Resume Next
    Set wsTarget = ThisWorkbook.Sheets("10")
    On Error GoTo 0

    ' Create the target sheet if it doesn't exist
    If wsTarget Is Nothing Then
        Set wsTarget = ThisWorkbook.Sheets.Add
        wsTarget.Name = "10"
    End If
    
    ' Clear contents on target sheet for fresh copy
    wsTarget.Cells.ClearContents

    ' Initialize collection to store unique values
    Set uniqueValues = New Collection

    ' Define last row with data in column B of source sheet
    lastRow = wsSource.Cells(wsSource.Rows.Count, "B").End(xlUp).Row

    ' Loop through each cell in column B
    For i = 2 To lastRow ' Start from row 2 to skip headers if any
        Set cell = wsSource.Cells(i, "B")
        
        On Error Resume Next
        uniqueValues.Add cell.Value, CStr(cell.Value) ' Add unique value to collection
        If Err.Number = 0 Then
            ' If unique, copy the entire row to the target sheet
            wsTarget.Rows(wsTarget.Cells(wsTarget.Rows.Count, "B").End(xlUp).Row + 1).Value = wsSource.Rows(i).Value
            ' Clear the row in the source sheet
            If rng Is Nothing Then
                Set rng = wsSource.Rows(i)
            Else
                Set rng = Union(rng, wsSource.Rows(i))
            End If
        End If
        On Error GoTo 0
    Next i

    ' Delete rows that were copied
    If Not rng Is Nothing Then rng.Delete

    MsgBox "Unique values have been copied to sheet '10' and removed from the original sheet.", vbInformation
End Sub